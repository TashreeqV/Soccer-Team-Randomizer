<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Teamify</title>
    <link rel="stylesheet" href="./style.css" />
    <link rel="icon" type="image/png" href="./Pictures/main.png" />
    <!-- Permanent Marker font -->
    <link href="https://fonts.googleapis.com/css2?family=Permanent+Marker&display=swap" rel="stylesheet" />
    <!-- html2canvas for downloads -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  </head>
  <body>
    <!-- Banner section -->
     <!-- TEsting change -->
    <div class="banner">
      <div class="logo">
        <img loading="lazy" src="./Pictures/main.png" alt="Teamify Logo" />
      </div>
      <h1><span>Teamify</span></h1>
    </div>

    <div class="main-layout">
      <!-- Tables -->
      <div class="team-table">
        <h3>Players & Teams</h3>
        <table>
          <!-- Selected players -->
          <tr class="dark-row">
            <th>#</th>
            <th>Selected Players</th>
          </tr>
          <tbody id="selectedList">
            <tr><td>-</td><td>-</td></tr>
          </tbody>

          <!-- Team 1 -->
          <tr class="dark-row" id="hdr-team1"><th>#</th><th>Team 1</th></tr>
          <tbody id="team1list"><tr><td>-</td><td>-</td></tr></tbody>
          <tr class="dark-row" id="hdr-subs1"><th>#</th><th>Team 1 Subs</th></tr>
          <tbody id="team1subs"><tr><td>-</td><td>-</td></tr></tbody>

          <!-- Team 2 -->
          <tr class="dark-row" id="hdr-team2"><th>#</th><th>Team 2</th></tr>
          <tbody id="team2list"><tr><td>-</td><td>-</td></tr></tbody>
          <tr class="dark-row" id="hdr-subs2"><th>#</th><th>Team 2 Subs</th></tr>
          <tbody id="team2subs"><tr><td>-</td><td>-</td></tr></tbody>
        </table>
      </div>

      <!-- Field -->
      <div class="field-wrapper">
        <div class="field-container">
          <img loading="lazy" src="./Pictures/fives.png" alt="Soccer Field" />
          <div id="teamOverlay"></div>
        </div>
      </div>

      <!-- Controls -->
      <div>
        <div class="controls-panel">
          <input
            type="text"
            id="playerInput"
            placeholder="Enter player name"
            onkeypress="if(event.key === 'Enter'){ addPlayer(); }"
          />
          <button class="add-btn" onclick="addPlayer()">Add Player</button>
          <button class="random-btn" onclick="randomizeTeams()">Randomize Teams</button>
          <button class="download-btn" onclick="downloadTeams()">Download Teams</button>
        </div>

        <!-- Team count -->
        <div class="team-settings">
          <label for="numTeams">Number of Teams:</label>
          <select id="numTeams" onchange="updateNumTeams()">
            <option value="2" selected>2</option>
            <option value="3">3</option>
            <option value="4">4</option>
          </select>
        </div>

        <!-- Team Colors -->
        <div class="team-settings">
          <h3>Team Colors</h3>
          <label for="team1Color">Team 1 Color:</label>
          <select id="team1Color" onchange="updateTeamColor(1)">
            <option value="red" selected>Red</option>
            <option value="black">Black</option>
            <option value="blue">Blue</option>
            <option value="green">Green</option>
            <option value="yellow">Yellow</option>
            <option value="orange">Orange</option>
            <option value="purple">Purple</option>
          </select>

          <label for="team2Color">Team 2 Color:</label>
          <select id="team2Color" onchange="updateTeamColor(2)">
            <option value="black" selected>Black</option>
            <option value="red">Red</option>
            <option value="blue">Blue</option>
            <option value="green">Green</option>
            <option value="yellow">Yellow</option>
            <option value="orange">Orange</option>
            <option value="purple">Purple</option>
          </select>
        </div>

        <!-- Formation controls -->
        <div class="formation-panel">
          <h3>Team 1 Formation</h3>
          <button class="formation-btn" onclick="setFormation('22', 1)">2-2</button>
          <button class="formation-btn" onclick="setFormation('31', 1)">3-1</button>
          <button class="formation-btn" onclick="setFormation('13', 1)">1-3</button>
          <button class="formation-btn" onclick="setFormation('diamond', 1)">Diamond</button>

          <h3 style="margin-top:16px">Team 2 Formation</h3>
          <button class="formation-btn" onclick="setFormation('22', 2)">2-2</button>
          <button class="formation-btn" onclick="setFormation('31', 2)">3-1</button>
          <button class="formation-btn" onclick="setFormation('13', 2)">1-3</button>
          <button class="formation-btn" onclick="setFormation('diamond', 2)">Diamond</button>
        </div>
      </div>
    </div>

    <script>
      // ---- State ----
      let selectedPlayers = [];
      let teams = { 1: [], 2: [] };
      let subs = { 1: [], 2: [] };
      let currentFormations = { 1: "22", 2: "22" };
      let numberOfTeams = 2;
      const MAX_PLAYERS = 40;

      // Team colors state
      let teamColors = {
        1: "red",
        2: "black",
      };

      // ---- Boot ----
      window.onload = () => {
        renderList("selectedList", selectedPlayers);
        renderTeam(1);
        renderTeam(2);
      };

      // ---- Rendering helpers ----
      function renderList(tbodyId, players) {
        const container = document.getElementById(tbodyId);
        if (!container) return;
        container.innerHTML = "";
        if (!players.length) {
          container.innerHTML = "<tr><td>-</td><td>-</td></tr>";
          return;
        }
        players.forEach((p, i) => {
          const row = document.createElement("tr");
          const numCell = document.createElement("td");
          const nameCell = document.createElement("td");
          numCell.textContent = i + 1;
          nameCell.textContent = p;

          const removeBtn = document.createElement("span");
          removeBtn.textContent = "âœ–";
          removeBtn.className = "remove-btn";
          removeBtn.onclick = () => removePlayer(p);

          nameCell.appendChild(removeBtn);
          row.appendChild(numCell);
          row.appendChild(nameCell);
          container.appendChild(row);
        });
      }

      function ensureTeamSections(team) {
        const table = document.querySelector(".team-table table");
        if (!document.getElementById(`team${team}list`)) {
          const hdrTeam = document.createElement("tr");
          hdrTeam.className = "dark-row";
          hdrTeam.innerHTML = `<th>#</th><th>Team ${team}</th>`;
          table.appendChild(hdrTeam);
          const bodyTeam = document.createElement("tbody");
          bodyTeam.id = `team${team}list`;
          bodyTeam.innerHTML = `<tr><td>-</td><td>-</td></tr>`;
          table.appendChild(bodyTeam);

          const hdrSubs = document.createElement("tr");
          hdrSubs.className = "dark-row";
          hdrSubs.innerHTML = `<th>#</th><th>Team ${team} Subs</th>`;
          table.appendChild(hdrSubs);
          const bodySubs = document.createElement("tbody");
          bodySubs.id = `team${team}subs`;
          bodySubs.innerHTML = `<tr><td>-</td><td>-</td></tr>`;
          table.appendChild(bodySubs);
        }
        if (!teams[team]) teams[team] = [];
        if (!subs[team]) subs[team] = [];
      }

      function renderTeam(team) {
        ensureTeamSections(team);
        renderList(`team${team}list`, teams[team]);
        renderList(`team${team}subs`, subs[team]);
      }

      // ---- Actions ----
      function addPlayer() {
        const input = document.getElementById("playerInput");
        const name = input.value.trim();
        if (!name) return;
        if (selectedPlayers.length + teams[1].length + teams[2].length >= MAX_PLAYERS) {
          alert("Max 40 players allowed!");
          return;
        }
        if ([...selectedPlayers, ...teams[1], ...teams[2]].includes(name)) {
          alert("That name is already added!");
          return;
        }
        selectedPlayers.push(name);
        renderList("selectedList", selectedPlayers);
        input.value = "";
      }

      function removePlayer(name) {
        selectedPlayers = selectedPlayers.filter((p) => p !== name);
        teams[1] = teams[1].filter((p) => p !== name);
        teams[2] = teams[2].filter((p) => p !== name);
        subs[1] = subs[1].filter((p) => p !== name);
        subs[2] = subs[2].filter((p) => p !== name);
        renderList("selectedList", selectedPlayers);
        renderTeam(1);
        renderTeam(2);
      }

      function randomizeTeams() {
        const all = [...selectedPlayers, ...teams[1], ...teams[2], ...subs[1], ...subs[2]];
        if (all.length < numberOfTeams * 2) {
          alert("Not enough players!");
          return;
        }
        const shuffled = all.sort(() => Math.random() - 0.5);
        teams = {};
        subs = {};
        for (let t = 1; t <= numberOfTeams; t++) {
          teams[t] = [];
          subs[t] = [];
          ensureTeamSections(t);
        }
        let idx = 0;
        for (const player of shuffled) {
          const t = (idx % numberOfTeams) + 1;
          if (teams[t].length < 5) teams[t].push(player);
          else subs[t].push(player);
          idx++;
        }
        selectedPlayers = [];
        renderList("selectedList", []);
        for (let t = 1; t <= numberOfTeams; t++) renderTeam(t);
        placePlayersOnField(teams[1], 1, currentFormations[1]);
        placePlayersOnField(teams[2], 2, currentFormations[2]);
      }

      function updateNumTeams() {
        const newCount = parseInt(document.getElementById("numTeams").value, 10);
        numberOfTeams = newCount;
        for (let t = 1; t <= numberOfTeams; t++) renderTeam(t);
      }

      function setFormation(type, team) {
        currentFormations[team] = type;
        if (team <= 2) placePlayersOnField(teams[team], team, type);
      }

      // ---- Field placement ----
      function placePlayersOnField(teamPlayers, team, formation) {
        const overlay = document.getElementById("teamOverlay");
        [...overlay.querySelectorAll(`.team${team}`)].forEach((el) => el.remove());
        if (!teamPlayers.length) return;
        const formations = {
          22: team === 1 ? [[50, 12],[25, 30],[75, 30],[35, 45],[65, 45]] : [[50, 82],[25, 68],[75, 68],[35, 56],[65, 56]],
          31: team === 1 ? [[50, 12],[20, 30],[50, 30],[80, 30],[50, 45]] : [[50, 82],[20, 68],[50, 68],[80, 68],[50, 56]],
          13: team === 1 ? [[50, 12],[50, 30],[25, 45],[75, 45],[50, 45]] : [[50, 82],[50, 68],[25, 56],[75, 56],[50, 52]],
          diamond: team === 1 ? [[50, 12],[30, 30],[70, 30],[50, 40],[50, 45]] : [[50, 82],[30, 68],[70, 68],[50, 58],[50, 52]],
        };
        const positions = formations[formation] || formations["22"];
        teamPlayers.forEach((player, i) => {
          if (!positions[i]) return;
          const pin = document.createElement("div");
          pin.className = `player team${team}`;
          pin.style.left = positions[i][0] + "%";
          pin.style.top = positions[i][1] + "%";
          pin.style.color = teamColors[team]; // apply chosen color
          pin.innerText = player;
          overlay.appendChild(pin);
        });
      }

      // ---- Team color updater ----
      function updateTeamColor(team) {
        const color = document.getElementById(`team${team}Color`).value;
        teamColors[team] = color;
        placePlayersOnField(teams[team], team, currentFormations[team]);
      }

      // ---- Download Teams ----
      function downloadTeams() {
        const captureEl = document.querySelector(".main-layout");
        html2canvas(captureEl, { scale: 2 }).then((canvas) => {
          const link = document.createElement("a");
          link.download = "teams.png";
          link.href = canvas.toDataURL("image/png");
          link.click();
        });
      }
    </script>
  </body>
</html>
